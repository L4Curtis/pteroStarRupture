{
  "_comment": "StarRupture Dedicated Server - Pelican Egg (Proton)",
  "meta": {
    "version": "PLCN_v1"
  },
  "name": "StarRupture",
  "author": "custom",
  "description": "StarRupture Dedicated Server using Proton (Windows server on Linux). Uses Epic Online Services (EOS). Password is set IN-GAME via Manage Server.",
  "features": [
    "steam_disk_space"
  ],

  "docker_images": {
    "Proton": "ghcr.io/parkervcp/steamcmd:proton"
  },

  "startup": "proton run ./StarRuptureServerEOS.exe -Log -MULTIHOME={{SERVER_IP}} -Port={{SERVER_PORT}} -QueryPort={{QUERY_PORT}} -ServerName=\"{{SERVER_NAME}}\" {{EXTRA_FLAGS}}",

  "config": {
    "startup": {
      "done": "LogInit"
    },
    "stop": "^C"
  },

  "scripts": {
    "installation": {
      "script": "#!/bin/bash\n# StarRupture Dedicated Server Install Script\n\nif [[ -z \"$STEAM_USER\" || -z \"$STEAM_PASS\" ]]; then\n  STEAM_USER=anonymous\n  STEAM_PASS=\"\"\n  STEAM_AUTH=\"\"\nfi\n\ncd /tmp\nmkdir -p /mnt/server/steamcmd\ncurl -sSL -o steamcmd.tar.gz https://steamcdn-a.akamaihd.net/client/installer/steamcmd_linux.tar.gz\ntar -xzvf steamcmd.tar.gz -C /mnt/server/steamcmd\n\nmkdir -p /mnt/server/steamapps\ncd /mnt/server/steamcmd\nexport HOME=/mnt/server\n\n./steamcmd.sh +@sSteamCmdForcePlatformType windows +login ${STEAM_USER} ${STEAM_PASS} ${STEAM_AUTH} +force_install_dir /mnt/server +app_update 3809400 validate +quit\n\n# Steam libs\nmkdir -p /mnt/server/.steam/sdk32\nmkdir -p /mnt/server/.steam/sdk64\ncp linux32/steamclient.so /mnt/server/.steam/sdk32/steamclient.so\ncp linux64/steamclient.so /mnt/server/.steam/sdk64/steamclient.so\n\n# Optional password reset\nif [[ \"$RESET_PASSWORD\" == \"1\" ]]; then\n  rm -f /mnt/server/Password.json\nfi\n\necho \"StarRupture installation complete\"",
      "container": "ghcr.io/parkervcp/installers:debian",
      "entrypoint": "bash"
    }
  },

  "variables": [
    {
      "name": "Server Name",
      "env_variable": "SERVER_NAME",
      "default_value": "StarRupture Dedicated Server",
      "user_viewable": true,
      "user_editable": true,
      "rules": ["required","string","max:128"]
    },
    {
      "name": "Server IP (MULTIHOME)",
      "env_variable": "SERVER_IP",
      "default_value": "0.0.0.0",
      "user_viewable": true,
      "user_editable": true,
      "rules": ["required","ip"]
    },
    {
      "name": "Server Port",
      "env_variable": "SERVER_PORT",
      "default_value": "7777",
      "user_viewable": true,
      "user_editable": false,
      "rules": ["required","integer","min:1025","max:65535"]
    },
    {
      "name": "Query Port",
      "env_variable": "QUERY_PORT",
      "default_value": "27015",
      "user_viewable": true,
      "user_editable": false,
      "rules": ["required","integer","min:1025","max:65535"]
    },
    {
      "name": "Extra Launch Flags",
      "description": "Additional command-line flags for StarRuptureServerEOS.exe",
      "env_variable": "EXTRA_FLAGS",
      "default_value": "",
      "user_viewable": true,
      "user_editable": true,
      "rules": ["nullable","string","max:512"]
    },
    {
      "name": "Reset Server Password",
      "description": "Deletes Password.json on install/start (forces new password in-game)",
      "env_variable": "RESET_PASSWORD",
      "default_value": "0",
      "user_viewable": true,
      "user_editable": true,
      "rules": ["boolean"]
    }
  ]
}
